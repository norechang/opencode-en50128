document_type: "Software-Architecture-Specification"
checker_version: "1.0"
description: "Quality checks for Software Architecture Specification per EN 50128 Section 7.3.4.1 and Table A.3"

# Template compliance checks (EN 50128 document structure)
template_checks:
  # Document ID format
  - id: "SAS-T001"
    name: "Document ID Format"
    description: "Verify Document ID follows DOC-SAS-YYYY-NNN format"
    severity: "error"
    rule_type: "regex"
    rule_params:
      pattern: "DOC-SAS-[0-9]{4}-[0-9]{3}"
      search_section: "STANDARD HEADER"
    expected: "Document ID matches DOC-SAS-YYYY-NNN (e.g., DOC-SAS-2026-001)"
    failure_message: "Document ID does not match required format DOC-SAS-YYYY-NNN"
    fix_suggestion: "Update Document ID to format DOC-SAS-YYYY-NNN (e.g., DOC-SAS-2026-001)"
  
  # Standard Header table
  - id: "SAS-T002"
    name: "Standard Header Table"
    description: "Verify Standard Header table exists with required fields"
    severity: "error"
    rule_type: "table_exists"
    rule_params:
      table_header: "STANDARD HEADER"
      required_columns: ["Field", "Value"]
      required_fields:
        - "Document ID"
        - "Version"
        - "Date"
        - "Project"
        - "SIL Level"
        - "Author"
        - "Status"
    expected: "Standard Header table with all required fields"
    failure_message: "Standard Header table missing or incomplete"
    fix_suggestion: "Add Standard Header table with fields: Document ID, Version, Date, Project, SIL Level, Author, Status"
  
  # Document Control table
  - id: "SAS-T003"
    name: "Document Control Table"
    description: "Verify Document Control table exists"
    severity: "error"
    rule_type: "table_exists"
    rule_params:
      table_header: "DOCUMENT CONTROL"
      required_columns: ["Version", "Date", "Author", "Changes", "Approved By"]
    expected: "Document Control table with version history"
    failure_message: "Document Control table missing or incomplete"
    fix_suggestion: "Add Document Control table with columns: Version, Date, Author, Changes, Approved By"
  
  # Approvals table
  - id: "SAS-T004"
    name: "Approvals Table"
    description: "Verify Approvals table exists with required roles"
    severity: "error"
    rule_type: "table_exists"
    rule_params:
      table_header: "APPROVALS"
      required_columns: ["Role", "Name", "Signature", "Date"]
      required_roles_sil_3:
        - "Author (Designer)"
        - "Independent Reviewer"
        - "QA Manager"
        - "Project Manager"
      minimum_sil: 3
    expected: "Approvals table with Author, Reviewer, QA, PM"
    failure_message: "Approvals table missing or incomplete (required SIL 3+)"
    fix_suggestion: "Add Approvals table with roles: Author (Designer), Independent Reviewer, QA Manager, Project Manager"
  
  # Required sections
  - id: "SAS-T005"
    name: "Required Sections"
    description: "Verify all required sections exist"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      required_sections:
        - "1. INTRODUCTION"
        - "2. SYSTEM ARCHITECTURE OVERVIEW"
        - "3. MODULE DECOMPOSITION"
        - "4. INTERFACE SPECIFICATIONS"
        - "5. DATA STRUCTURES"
        - "6. CONTROL FLOW"
        - "7. SAFETY ARCHITECTURE"
        - "8. MEMORY ALLOCATION"
        - "9. DEFENSIVE PROGRAMMING"
        - "10. REQUIREMENTS TRACEABILITY"
        - "11. EN 50128 COMPLIANCE"
    expected: "All required sections present"
    failure_message: "One or more required sections missing"
    fix_suggestion: "Add missing sections per EN 50128 Section 7.3 architecture requirements"

# Quality standards checks
quality_checks:
  # Module ID format
  - id: "SAS-Q001"
    name: "Module ID Format"
    description: "Verify all modules have IDs in MOD-NNN format"
    severity: "error"
    rule_type: "all_items_match"
    rule_params:
      item_marker: "**MOD-"
      id_pattern: "^MOD-[0-9]{3}"
    expected: "All modules have IDs matching MOD-NNN"
    failure_message: "One or more modules have invalid ID format"
    fix_suggestion: "Ensure all module IDs follow MOD-NNN format (e.g., MOD-001)"
  
  # Module responsibilities defined
  - id: "SAS-Q002"
    name: "Module Responsibilities"
    description: "Verify all modules have responsibilities defined"
    severity: "error"
    rule_type: "all_items_match"
    rule_params:
      item_marker: "**MOD-"
      field_pattern: "(Responsibility:|Purpose:)"
      field_description: "module responsibility"
    expected: "All modules have responsibilities defined"
    failure_message: "One or more modules missing responsibility definition"
    fix_suggestion: "Add responsibility/purpose statement to all modules"
  
  # Module interfaces defined
  - id: "SAS-Q003"
    name: "Module Interfaces"
    description: "Verify all modules have interfaces defined"
    severity: "error"
    rule_type: "all_items_match"
    rule_params:
      item_marker: "**MOD-"
      field_pattern: "(Interface:|API:|Public Functions:)"
      field_description: "module interface"
    expected: "All modules have interfaces/APIs defined"
    failure_message: "One or more modules missing interface definition"
    fix_suggestion: "Add interface/API specification to all modules"
  
  # EN 50128 Table A.3 compliance
  - id: "SAS-Q004"
    name: "EN 50128 Table A.3 Compliance"
    description: "Verify EN 50128 Table A.3 techniques documented"
    severity: "error"
    rule_type: "content_check"
    rule_params:
      section: "1. INTRODUCTION"
      required_content:
        - "Table A.3"
        - "Structured Methodology"
        - "Modular Approach"
    expected: "EN 50128 Table A.3 techniques documented in Introduction"
    failure_message: "EN 50128 Table A.3 compliance not documented"
    fix_suggestion: "Add section 1.3 with Table A.3 techniques applied (Structured Methodology M, Modular Approach M for SIL 2+)"
  
  # SIL level specified
  - id: "SAS-Q005"
    name: "SIL Level Specified"
    description: "Verify SIL level specified in header"
    severity: "error"
    rule_type: "content_check"
    rule_params:
      section: "STANDARD HEADER"
      field_pattern: "SIL Level.*[0-4]"
    expected: "SIL level (0-4) specified in Standard Header"
    failure_message: "SIL level not specified in Standard Header"
    fix_suggestion: "Add SIL Level field to Standard Header table"

# Architecture quality checks
architecture_checks:
  # Minimum module count (modular approach)
  - id: "SAS-A001"
    name: "Modular Decomposition"
    description: "Verify system decomposed into modules (M for SIL 2+)"
    severity: "error"
    rule_type: "count_minimum"
    rule_params:
      item_pattern: "^\\*\\*MOD-[0-9]{3}"
      minimum_count: 2
      minimum_sil: 2
    expected: "At least 2 modules defined (modular approach M for SIL 2+)"
    failure_message: "Insufficient modular decomposition (mandatory SIL 2+)"
    fix_suggestion: "Decompose system into at least 2 modules per EN 50128 Table A.3 (Modular Approach M for SIL 2+)"
  
  # Layered architecture (recommended)
  - id: "SAS-A002"
    name: "Layered Architecture"
    description: "Verify layered architecture documented"
    severity: "warning"
    rule_type: "content_check"
    rule_params:
      section: "2. SYSTEM ARCHITECTURE OVERVIEW"
      field_pattern: "(Layer|Tier|Abstraction Level)"
    expected: "Layered architecture documented (recommended)"
    failure_message: "Layered architecture not documented (recommended for maintainability)"
    fix_suggestion: "Document layered architecture (e.g., Hardware Abstraction, Control Logic, Application)"
  
  # Interface specifications complete
  - id: "SAS-A003"
    name: "Interface Specifications Complete"
    description: "Verify interface specifications section exists (HR for SIL 3-4)"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      section: "4. INTERFACE SPECIFICATIONS"
      content_must_contain:
        - "Input"
        - "Output"
      minimum_sil: 2
    expected: "Interface Specifications section with inputs/outputs (HR for SIL 3-4)"
    failure_message: "Interface Specifications incomplete (highly recommended SIL 3-4)"
    fix_suggestion: "Add section 4 with complete interface specifications (data types, ranges, error codes)"
  
  # Data structures defined
  - id: "SAS-A004"
    name: "Data Structures Defined"
    description: "Verify data structures section exists"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      section: "5. DATA STRUCTURES"
      content_must_contain: "struct"
    expected: "Data Structures section with struct definitions"
    failure_message: "Data Structures section missing or incomplete"
    fix_suggestion: "Add section 5 with data structure definitions (structs, enums, typedefs)"
  
  # Control flow documented
  - id: "SAS-A005"
    name: "Control Flow Documented"
    description: "Verify control flow section exists"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      section: "6. CONTROL FLOW"
      content_must_contain:
        - "state"
        - "flow"
    expected: "Control Flow section with state machines or flow diagrams"
    failure_message: "Control Flow section missing or incomplete"
    fix_suggestion: "Add section 6 with control flow (state machines, flowcharts, sequence diagrams)"
  
  # Safety architecture patterns
  - id: "SAS-A006"
    name: "Safety Architecture Patterns"
    description: "Verify safety architecture section exists (SIL 1+)"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      section: "7. SAFETY ARCHITECTURE"
      content_must_contain:
        - "safety"
      minimum_sil: 1
    expected: "Safety Architecture section (required SIL 1+)"
    failure_message: "Safety Architecture section missing (mandatory SIL 1+)"
    fix_suggestion: "Add section 7 with safety patterns (redundancy, fail-safe, watchdog, defensive programming)"

# SIL-specific constraint checks
sil_constraints:
  # Static memory allocation (M for SIL 2+)
  - id: "SAS-S001"
    name: "Static Allocation Specified"
    description: "Verify static memory allocation strategy (M for SIL 2+)"
    severity: "error"
    rule_type: "content_check"
    rule_params:
      section: "8. MEMORY ALLOCATION"
      required_content:
        - "static"
        - "allocation"
      forbidden_content:
        - "malloc"
        - "free"
        - "calloc"
        - "realloc"
      minimum_sil: 2
    expected: "Static allocation specified, no dynamic allocation (M for SIL 2+)"
    failure_message: "Static memory allocation not specified or dynamic allocation mentioned (mandatory SIL 2+)"
    fix_suggestion: "Add section 8 specifying static allocation only, no malloc/free/calloc/realloc (M for SIL 2+)"
  
  # No recursion (HR for SIL 3-4)
  - id: "SAS-S002"
    name: "No Recursion Specified"
    description: "Verify no recursion constraint (HR for SIL 3-4)"
    severity: "error"
    rule_type: "content_check"
    rule_params:
      section: "9. DEFENSIVE PROGRAMMING"
      required_content:
        - "no recursion"
      minimum_sil: 3
    expected: "No recursion constraint specified (HR for SIL 3-4)"
    failure_message: "No recursion constraint not specified (highly recommended SIL 3-4)"
    fix_suggestion: "Add no recursion constraint to section 9 (HR for SIL 3-4)"
  
  # Complexity limits (≤10 for SIL 3-4, ≤15 for SIL 2)
  - id: "SAS-S003"
    name: "Complexity Limits Specified"
    description: "Verify cyclomatic complexity limits specified"
    severity: "error"
    rule_type: "content_check"
    rule_params:
      section: "9. DEFENSIVE PROGRAMMING"
      sil_2_pattern: "complexity.*≤?\\s*15"
      sil_3_4_pattern: "complexity.*≤?\\s*10"
      minimum_sil: 2
    expected: "Complexity limits: ≤15 (SIL 2), ≤10 (SIL 3-4)"
    failure_message: "Cyclomatic complexity limits not specified"
    fix_suggestion: "Add complexity limits: ≤15 per function (SIL 2), ≤10 per function (SIL 3-4)"
  
  # Defensive programming patterns (HR for SIL 3-4)
  - id: "SAS-S004"
    name: "Defensive Programming Patterns"
    description: "Verify defensive programming patterns specified (HR for SIL 3-4)"
    severity: "error"
    rule_type: "content_check"
    rule_params:
      section: "9. DEFENSIVE PROGRAMMING"
      required_patterns:
        - "input validation"
        - "NULL.*check"
        - "bounds.*check"
      minimum_sil: 3
    expected: "Defensive programming patterns specified (HR for SIL 3-4)"
    failure_message: "Defensive programming patterns not adequately specified (highly recommended SIL 3-4)"
    fix_suggestion: "Add defensive programming patterns to section 9: input validation, NULL checks, bounds checking, error handling"

# Traceability checks
traceability_checks:
  # Requirements traceability section
  - id: "SAS-TR001"
    name: "Requirements Traceability Section"
    description: "Verify requirements traceability section exists"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      section: "10. REQUIREMENTS TRACEABILITY"
      content_must_contain:
        - "REQ-"
        - "MOD-"
    expected: "Requirements Traceability section maps requirements to modules"
    failure_message: "Requirements Traceability section missing or incomplete"
    fix_suggestion: "Add section 10 with traceability matrix: Requirements (REQ-XXX-NNN) → Modules (MOD-NNN)"
  
  # 100% requirements coverage (M for SIL 3-4)
  - id: "SAS-TR002"
    name: "Requirements Coverage"
    description: "Verify 100% requirements traced to architecture (M for SIL 3-4)"
    severity: "error"
    rule_type: "coverage_check"
    rule_params:
      coverage_type: "requirements"
      minimum_coverage: 100
      source_doc: "docs/SRS.md"
      item_pattern: "REQ-[A-Z]+-[0-9]{3}"
      minimum_sil: 3
    expected: "100% requirements traced to modules (M for SIL 3-4)"
    failure_message: "Requirements coverage < 100% (mandatory SIL 3-4)"
    fix_suggestion: "Ensure all requirements from SRS are traced to at least one module in section 10"
  
  # EN 50128 compliance matrix
  - id: "SAS-TR003"
    name: "EN 50128 Compliance Matrix"
    description: "Verify EN 50128 compliance matrix section exists"
    severity: "error"
    rule_type: "section_exists"
    rule_params:
      section: "11. EN 50128 COMPLIANCE"
      content_must_contain:
        - "Table A.3"
    expected: "EN 50128 Compliance section with Table A.3 mapping"
    failure_message: "EN 50128 Compliance section missing"
    fix_suggestion: "Add section 11 with EN 50128 Table A.3 compliance matrix showing which techniques are applied"

# Content consistency checks
consistency_checks:
  # All modules referenced in interfaces
  - id: "SAS-CO001"
    name: "Module Interface Consistency"
    description: "Verify all modules have interfaces defined in section 4"
    severity: "warning"
    rule_type: "cross_reference_check"
    rule_params:
      source_section: "3. MODULE DECOMPOSITION"
      source_pattern: "MOD-[0-9]{3}"
      target_section: "4. INTERFACE SPECIFICATIONS"
      target_pattern: "MOD-[0-9]{3}"
    expected: "All modules from section 3 have interfaces in section 4"
    failure_message: "Some modules lack interface specifications"
    fix_suggestion: "Add interface specifications to section 4 for all modules defined in section 3"
  
  # All modules traced to requirements
  - id: "SAS-CO002"
    name: "Module Traceability Consistency"
    description: "Verify all modules traced to requirements in section 10"
    severity: "error"
    rule_type: "cross_reference_check"
    rule_params:
      source_section: "3. MODULE DECOMPOSITION"
      source_pattern: "MOD-[0-9]{3}"
      target_section: "10. REQUIREMENTS TRACEABILITY"
      target_pattern: "MOD-[0-9]{3}"
    expected: "All modules from section 3 traced to requirements in section 10"
    failure_message: "Some modules not traced to requirements"
    fix_suggestion: "Add traceability for all modules to section 10"
