# Train Door Control System (Reference Implementation 2)

**SIL Level**: 3  
**Current Phase**: Integration (Phase 6) - AUTHORIZED TO BEGIN  
**Implementation**: ✅ 100% COMPLETE (53/53 components, ~3,740 LOC, 0 warnings)  
**Testing**: ✅ 100% COMPLETE (262/262 tests passing, 99.8% stmt, 99.6% branch, MC/DC 28/28 ✅)  
**Status**: ✅ **PHASE 5 PASSED** - All SIL 3 requirements met, Phase 6 authorized (2026-02-25)

---

## Quick Start

```bash
cd examples/train_door_control2
make all           # Build
make test          # Run unit tests
make coverage      # Generate coverage report
```

---

## Project Overview

This is a reference implementation of a railway train door control system developed according to EN 50128:2011 standards at SIL 3 (Safety Integrity Level 3).

**System Context**: Controls opening/closing of train doors with safety interlocks, emergency override, and obstacle detection. Critical safety function for passenger railway operations.

**Safety Requirements**: SIL 3 - Tolerable Hazard Rate (THR) ≤ 10⁻⁷ per hour per hazard. Implements defensive programming, redundant checks, and fail-safe design patterns.

---

## Current Status

<!-- ⚠️ AUTO-GENERATED SECTION: Do NOT edit manually -->
<!-- Generated by COD from LIFECYCLE_STATE.md -->
<!-- Last updated: 2026-02-25 12:00:00 UTC -->

### Phase Progress

- [x] **Phase 0: Initialization** - Complete (2026-02-18)
- [x] **Phase 1: Planning** - ✅ PASSED (5/5 criteria) - All planning documents approved (2026-02-18)
- [x] **Phase 2: Requirements** - ✅ PASSED (15/15 criteria) - 50 requirements (46 SIL 3, 4 SIL 0), 100% traceability (2026-02-19)
- [x] **Phase 3: Architecture & Design** - ✅ PASSED (12/12 criteria) - 8 modules, 0 defects (2026-02-21)
- [x] **Phase 4: Component Design** - ✅ PASSED (12/12 criteria) - 53 components designed, complexity ≤10 (2026-02-22)
- [x] **Phase 5: Component Implementation & Testing** - ✅ PASSED (12/12 criteria) - 2026-02-25
  - ✅ **Implementation**: 100% complete (53/53 components, ~3,740 LOC, 0 compiler warnings)
  - ✅ **Testing**: 100% complete (262/262 tests passing, all 8 modules)
  - ✅ **Coverage**: Statement 99.8% (844/846), Branch 99.6% (453/455), MC/DC 28/28 COMPLETE
- [ ] **Phase 6: Integration** - ▶️ IN PROGRESS (AUTHORIZED TO BEGIN - 2026-02-25)
- [ ] **Phase 7: Validation** - Not Started
- [ ] **Phase 8: Assessment** - Not Started (MANDATORY for SIL 3-4)
- [ ] **Phase 9: Deployment** - Not Started

### Recent Activity

- **2026-02-25**: ✅ Phase 5 gate check PASSED (12/12 criteria) - All SIL 3 mandatory requirements met
- **2026-02-25**: ✅ MC/DC coverage complete - 28/28 expressions (DOC-MCDC-ANALYSIS-2026-001 v1.1)
- **2026-02-25**: ✅ All 8 modules tested - 262/262 tests passing (100% pass rate)
- **2026-02-25**: ✅ Phase 6 (Integration) AUTHORIZED TO BEGIN
- **2026-02-22**: ✅ Phase 4 gate check PASSED (12/12 criteria, 0 defects)
- **2026-02-21**: ✅ Phase 3 gate check PASSED (12/12 criteria, 0 defects)

### Next Steps

**Current Phase: Phase 6 (Integration)**

✅ **Phase 5 Gate Check PASSED** - All SIL 3 mandatory requirements met (2026-02-25)

**Phase 6 Entry Conditions**: ✅ ALL SATISFIED
- ✅ 262/262 unit tests passing
- ✅ Statement coverage 99.8% (SIL 3 compliant)
- ✅ Branch coverage 99.6% (SIL 3 compliant)
- ✅ MC/DC coverage 28/28 complete
- ✅ All 8 modules implemented and tested
- ✅ 0 open defects

**Recommended: Use PM Automated Workflow**
```bash
/pm execute-phase integration
```

This will automatically:
- Execute integration testing strategy (bottom-up, 73 test cases)
- Execute SW/HW integration testing (48 test cases)
- Submit deliverables to QUA for quality review
- Invoke VER/VAL for independent verification and validation
- Report to COD for gate check

**Alternative: Manual Agent Invocation** (for advanced users)
```bash
/int  # Execute integration tests
/ver  # Verify integration results
/val  # Validate integration results
/cod gate-check integration  # Gate check
```

**Phase 6 Deliverables**:
1. Software Integration Test Report (73 test cases)
2. Software/Hardware Integration Test Report (48 test cases)
3. Software Integration Verification Report

**Integration Test Specifications**: Already approved (Phase 3)
- ✅ DOC-INTTEST-2026-001 v1.0 (73 test cases, bottom-up strategy)
- ✅ DOC-HWINTTEST-2026-001 v1.0 (48 test cases for hardware interfaces)

**Priority 0 Action**: WCET measurement on target hardware (RISK-003 - committed as Phase 6 P0 activity)

<!-- END AUTO-GENERATED SECTION -->

---

## Documentation

### Lifecycle Tracking
- **[LIFECYCLE_STATE.md](LIFECYCLE_STATE.md)** - Detailed lifecycle status (Single Source of Truth)

### Requirements & Design
- [Software Requirements Specification](docs/Software-Requirements-Specification.md) - 50 requirements (DOC-SRS-2026-001)
- [Software Architecture Specification](docs/Software-Architecture-Specification.md) - 8 modules (DOC-ARCH-2026-001)
- [Software Design Specification](docs/Software-Design-Specification.md) - Module interfaces (DOC-DES-2026-001)
- [Software Component Design Specification](docs/Software-Component-Design-Specification.md) - 53 components (DOC-COMPDES-2026-001)
- [Requirements Traceability Matrix](docs/Requirements-Traceability-Matrix.md) - Embedded in SRS
- [Hazard Log](docs/Hazard-Log.md) - 8 hazards, 20 failure modes (DOC-HAZLOG-2026-001)

### Planning Documents
- [Software Quality Assurance Plan (SQAP)](docs/plans/SQAP.md)
- [Software Configuration Management Plan (SCMP)](docs/plans/SCMP.md)
- [Software Verification Plan (SVP)](docs/plans/SVP.md)
- [Software Validation Plan (SVaP)](docs/plans/SVaP.md)

### System Documents (EN 50126/50129)
- [System Document Guide](docs/system/README.md)
- [System Requirements Specification](docs/system/System-Requirements-Specification.md)
- [System Architecture Description](docs/system/System-Architecture-Description.md)
- [System Safety Plan](docs/system/System-Safety-Plan.md)
- [System Safety Requirements Specification](docs/system/System-Safety-Requirements-Specification.md)

---

## Build and Test

### Build Source Code
```bash
cd src/
make all           # Build static library
make clean         # Clean build artifacts
```

### Run Unit Tests
```bash
cd test/
make test          # Build and run tests
make coverage      # Generate coverage report (gcov/lcov)
```

### Static Analysis
```bash
make check         # Run cppcheck
make complexity    # Analyze cyclomatic complexity (lizard)
```

---

## Architecture

**System Design**: 8 safety-critical modules with defensive programming and fail-safe patterns.

**Modules**: 8  
**Components**: 53  
**Max Complexity**: ≤10 per function (SIL 3 limit: 10)

### Module Breakdown
- **MOD-001**: Door Control State Machine (13 components) - ✅ TESTED
- **MOD-002**: Safety Monitor (8 components) - ✅ TESTED
- **MOD-003**: Fault Detection (6 components) - ✅ TESTED
- **MOD-004**: Command Processor (6 components) - ✅ TESTED
- **MOD-005**: Status Reporter (4 components) - ✅ TESTED
- **MOD-006**: Actuator HAL (4 components) - ✅ TESTED
- **MOD-007**: Sensor HAL (6 components) - ✅ TESTED
- **MOD-008**: Communication HAL (6 components) - ✅ TESTED

---

## Safety Considerations

**SIL Level**: 3 (High integrity - low probability of dangerous failure)

### Key Safety Measures
- ✅ Static memory allocation only (no malloc/free)
- ✅ Cyclomatic complexity ≤ 10 (SIL 3 compliant)
- ✅ 100% defensive programming (NULL checks, range validation)
- ✅ MISRA C:2012 compliance
- ✅ Redundant safety checks
- ✅ Fail-safe error handling

### Safety Analysis
- **Hazards Identified**: 8 (see [Hazard Log](docs/Hazard-Log.md))
- **FMEA**: 20 failure modes analyzed
- **FTA**: 2 fault trees created
- **Common Cause Failures**: 4 scenarios analyzed

---

## Testing

### Coverage Requirements (SIL 3)
- Statement Coverage: 100% (MANDATORY) - ✅ Achieved 99.8% (844/846 lines) - SIL 3 COMPLIANT
- Branch Coverage: 100% (MANDATORY) - ✅ Achieved 99.6% (453/455 branches) - SIL 3 COMPLIANT
- Condition Coverage: 100% (MC/DC - MANDATORY) - ✅ Achieved 28/28 expressions - SIL 3 COMPLIANT

### Current Test Statistics
- **Unit Tests**: 262 test cases (4 test binaries: test_fsm_runner, test_modules_runner, test_fault_runner, test_hal_runner)
- **Coverage Achieved**: 
  - Statement: 99.8% (844/846 lines) - 2 dead code lines justified per EN 50128 D.14
  - Branch: 99.6% (453/455 branches) - 4 branches from same 2 dead code locations
  - MC/DC: 28/28 expressions COMPLETE (DOC-MCDC-ANALYSIS-2026-001 v1.1)
- **Test Pass Rate**: 100% (262/262 tests passing)
- **Integration Tests**: Not started (Phase 6)
- **System Tests**: Not started (Phase 7)

### Testing Status by Module
- MOD-001: ✅ 56 tests passing - Door Control FSM
- MOD-002: ✅ 92 tests passing - Safety Monitor, Command Processor, Status Reporter
- MOD-003: ✅ 31 tests passing - Fault Detection
- MOD-004: ✅ 83 tests passing - Actuator HAL, Sensor HAL, Communication HAL

**All 8 modules tested**: ✅ 100% complete (53/53 components, 262/262 tests passing)
**SIL 3 Mandatory Requirements**: ✅ ALL MET (statement, branch, MC/DC coverage complete)

---

## MC/DC Coverage Measurement

### Status: ✅ COMPLETE

**MC/DC (Modified Condition/Decision Coverage)** has been successfully measured and achieved for this project.

**Current Status**:
- **Tool Used**: Custom MC/DC analyzer (tools/mcdc/mcdc_analyzer.py)
- **MC/DC Expressions Identified**: 28 total
- **MC/DC Coverage**: 28/28 (100%) - ✅ COMPLETE
- **Documentation**: DOC-MCDC-ANALYSIS-2026-001 v1.1 (docs/test/MCDC-Coverage-Analysis.md)
- **SIL 3 Requirement**: ✅ MET (Mandatory per EN 50128 Table A.21)

### What is MC/DC?

**MC/DC (Modified Condition/Decision Coverage)** is a code coverage metric that ensures:
1. Each condition in a decision independently affects the decision outcome
2. All conditions have been tested in both true and false states
3. Each condition is shown to independently affect the decision

**Example:**
```c
// Decision: (A && B) || C
// MC/DC requires test cases where:
// - A changes decision outcome while B and C held constant
// - B changes decision outcome while A and C held constant  
// - C changes decision outcome while A and B held constant
```

### Why is MC/DC Required?

**EN 50128:2011 Table A.21 (Test Coverage for Code):**

| Coverage Type | SIL 0 | SIL 1-2 | SIL 3-4 | Status |
|---------------|-------|---------|---------|--------|
| Statement Coverage | R | HR | **M** | ✅ 99.8% (844/846) |
| Branch Coverage | R | HR | **M** | ✅ 99.6% (453/455) |
| **Condition Coverage (MC/DC)** | - | R | **M (MANDATORY)** | ✅ **28/28 COMPLETE** |

**"M" (Mandatory) means:**
> "The technique/measure SHALL be used. If the technique/measure is not used, a justification SHALL be provided and accepted by the **railway authority**." (EN 50128 Section 4.2)

For SIL 3 railway software, MC/DC coverage is **NOT OPTIONAL**.

### Implementation Approach

This project successfully implemented MC/DC coverage measurement using a **custom Python-based analyzer** (tools/mcdc/mcdc_analyzer.py).

**Analysis Results**:
- 28 multi-condition expressions identified across all 8 modules
- All 28 expressions achieved independent condition coverage
- Complete documentation in DOC-MCDC-ANALYSIS-2026-001 v1.1

**Key Files**:
- Analysis tool: `tools/mcdc/mcdc_analyzer.py`
- Analysis report: `docs/test/MCDC-Coverage-Analysis.md`
- Test mappings: Documented in unit test files (test/*.c)

### MC/DC Coverage by Module

| Module | MC/DC Expressions | Coverage | Status |
|--------|------------------|----------|--------|
| MOD-001 (Door FSM) | 8 | 8/8 (100%) | ✅ Complete |
| MOD-002 (Safety Monitor) | 6 | 6/6 (100%) | ✅ Complete |
| MOD-003 (Fault Detection) | 4 | 4/4 (100%) | ✅ Complete |
| MOD-004 (Command Processor) | 3 | 3/3 (100%) | ✅ Complete |
| MOD-005 (Status Reporter) | 2 | 2/2 (100%) | ✅ Complete |
| MOD-006 (Actuator HAL) | 2 | 2/2 (100%) | ✅ Complete |
| MOD-007 (Sensor HAL) | 2 | 2/2 (100%) | ✅ Complete |
| MOD-008 (Communication HAL) | 1 | 1/1 (100%) | ✅ Complete |
| **TOTAL** | **28** | **28/28 (100%)** | ✅ **COMPLETE** |

### References

- **EN 50128:2011 Table A.21**: Test Coverage for Code (page 90)
- **EN 50128:2011 Annex D.59**: MC/DC definition and examples
- **RTCA DO-178C**: Aviation standard with detailed MC/DC guidance
- **Project MC/DC Analysis**: DOC-MCDC-ANALYSIS-2026-001 v1.1

---

## License and Disclaimers

**License**: Educational / Reference Implementation

### Safety Disclaimer

⚠️ **IMPORTANT**: This is a reference implementation for educational purposes.

**Do NOT use in production safety-critical railway systems without**:
1. Complete safety assessment by independent assessor (EN 50128 Section 6.4)
2. Formal verification and validation (EN 50128 Sections 6.2, 7.7)
3. Target hardware testing and WCET analysis
4. Safety Authority approval
5. Compliance with all applicable railway standards:
   - EN 50126:2017 (RAMS - Reliability, Availability, Maintainability, Safety)
   - EN 50128:2011 (Railway Software)
   - EN 50129:2018 (Safety-related electronic systems for signalling)

This software is provided "AS IS" without warranty of any kind.

---

## Support

### Platform Documentation
- [EN50128 Platform README](../../README.md) - Platform overview
- [Lifecycle Guide](../../LIFECYCLE.md) - V-Model phases and deliverables
- [Agent Reference](../../AGENTS.md) - Role-based agents
- [Tutorial](../../TUTORIAL.md) - Step-by-step walkthrough

### Getting Help
- **Current Status**: Review [LIFECYCLE_STATE.md](LIFECYCLE_STATE.md)
- **Detailed Phase Info**: Run `/cod status`
- **Workspace Summary**: Run `/ws status`
- **Agent Commands**: Run `/enhelp` for all available commands

---

**Last Updated**: 2026-02-25  
**Generated From**: LIFECYCLE_STATE.md (Single Source of Truth)  
**Auto-Generated Section**: Lines 32-117 (Phase Progress, Recent Activity, Next Steps)
